# Plan: Campaign Website with htmx + Go/Fiber + templ

**Goal:** Build a fully working proof of concept (PoC) campaign site with static pages + dynamic donation system.

**Status:** Ready for agent scaffolding. Agent follows sections in order. Plan includes concrete examples and test scenarios.

---

## 1. Project Structure

```
campaign/
â”œâ”€â”€ main.go                              # Fiber server: serves static + API routes
â”œâ”€â”€ build.go                             # SSG builder: generates HTML to public/
â”œâ”€â”€ go.mod                               # Go module dependencies
â”œâ”€â”€ go.sum                               # Dependency lock file
â”œâ”€â”€ Makefile                             # Build automation
â”œâ”€â”€ README.md                            # Quick start guide
â”‚
â”œâ”€â”€ templates/                           # Templ components (.templ files)
â”‚   â”œâ”€â”€ layout.templ                     # Base HTML layout (header, nav, footer)
â”‚   â”œâ”€â”€ home.templ                       # Landing page component
â”‚   â”œâ”€â”€ about.templ                      # About page component
â”‚   â”œâ”€â”€ blog.templ                       # Blog list + single post components
â”‚   â”œâ”€â”€ donation_form.templ              # Donation form fragment
â”‚   â”œâ”€â”€ donation_stats.templ             # Live stats fragment (total + count)
â”‚   â””â”€â”€ donation_success.templ           # Success message fragment
â”‚
â”œâ”€â”€ public/                              # Static output (generated by build.go)
â”‚   â”œâ”€â”€ index.html                       # Generated: home page
â”‚   â”œâ”€â”€ about.html                       # Generated: about page
â”‚   â”œâ”€â”€ blog.html                        # Generated: blog list
â”‚   â”œâ”€â”€ blog/                            # Generated: individual posts
â”‚   â”‚   â”œâ”€â”€ welcome.html                 # Example post
â”‚   â”‚   â””â”€â”€ how-to-contribute.html       # Example post
â”‚   â”œâ”€â”€ style.css                        # Blank stylesheet
â”‚   â””â”€â”€ htmx.min.js                      # HTMX library (or CDN link)
â”‚
â”œâ”€â”€ data/                                # Blog post definitions
â”‚   â””â”€â”€ posts.go                         # Blog posts as Go structs (hardcoded for PoC)
â”‚
â””â”€â”€ .gitignore                           # Exclude public/, build artifacts
```

---

## 2. Dependencies

**`go.mod` should include:**

```go
require (
    github.com/gofiber/fiber/v2 v2.52.0
    github.com/a-h/templ v0.2.543
)
```

**Install:**
```bash
go mod download
go install github.com/a-h/templ/cmd/templ@latest
```

---

## 3. Data Models

### BlogPost Struct (in `data/posts.go`)
```go
package data

type BlogPost struct {
    Slug    string  // URL slug: "welcome"
    Title   string  // Display title
    Content string  // HTML content (for PoC, just text)
    Date    string  // Published date: "2025-11-02"
}

// GetBlogPosts returns all blog posts (hardcoded for PoC)
func GetBlogPosts() []BlogPost {
    return []BlogPost{
        {
            Slug:    "welcome",
            Title:   "Welcome to the Campaign",
            Content: "We're excited to launch this campaign. Our goal is to make a real difference.",
            Date:    "2025-11-02",
        },
        {
            Slug:    "how-to-contribute",
            Title:   "How to Contribute",
            Content: "There are many ways to support our cause. You can donate, volunteer, or share our message.",
            Date:    "2025-11-01",
        },
    }
}
```

### Donation Struct (in `main.go`)
```go
type Donation struct {
    ID        int       `json:"id"`
    Name      string    `json:"name"`
    Email     string    `json:"email"`
    Amount    float64   `json:"amount"`
    Message   string    `json:"message,omitempty"`
    CreatedAt time.Time `json:"created_at"`
}
```

---

## 4. Templ Components

### 4.1 Layout (`templates/layout.templ`)

```templ
package templates

import "context"

templ Layout(title string, content templ.Component) {
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>{ title } - Campaign</title>
        <link rel="stylesheet" href="/style.css"/>
        <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    </head>
    <body>
        <nav>
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/blog.html">Blog</a>
        </nav>

        <main class="container">
            @content
        </main>

        <footer>
            <p>&copy; 2025 Campaign. All rights reserved.</p>
        </footer>
    </body>
    </html>
}
```

### 4.2 Home (`templates/home.templ`)

```templ
package templates

templ Home() {
    @Layout("Home", homeContent())
}

templ homeContent() {
    <section>
        <h1>Welcome to Our Campaign</h1>
        <p>Help us make a real difference in our community.</p>

        <!-- Live stats: fetched via htmx on page load -->
        <div hx-get="/api/stats" hx-trigger="load" hx-swap="innerHTML">
            <p>Loading stats...</p>
        </div>

        <!-- Donation form -->
        <section class="donation-section">
            <h2>Support Our Cause</h2>
            <form hx-post="/api/donations" hx-target="#donation-result" hx-swap="innerHTML">
                <input type="text" name="name" placeholder="Your Name" required/>
                <input type="email" name="email" placeholder="Email" required/>
                <input type="number" name="amount" placeholder="Amount" step="0.01" required/>
                <textarea name="message" placeholder="Message (optional)"></textarea>
                <button type="submit">Donate</button>
            </form>
            <div id="donation-result"></div>
        </section>

        <!-- Recent donors: fetched via htmx on page load and after donation -->
        <section>
            <h3>Recent Supporters</h3>
            <div hx-get="/api/recent-donors" hx-trigger="load, donationComplete from:body" hx-swap="innerHTML">
                <p>Loading donors...</p>
            </div>
        </section>
    </section>
}
```

### 4.3 About (`templates/about.templ`)

```templ
package templates

templ About() {
    @Layout("About", aboutContent())
}

templ aboutContent() {
    <section>
        <h1>About Our Campaign</h1>
        <p>We believe in bringing people together for a common cause.</p>
        <h2>Our Mission</h2>
        <p>To create sustainable positive change through community engagement and collective action.</p>
    </section>
}
```

### 4.4 Blog (`templates/blog.templ`)

```templ
package templates

import "campaign/data"

templ BlogList(posts []data.BlogPost) {
    @Layout("Blog", blogListContent(posts))
}

templ blogListContent(posts []data.BlogPost) {
    <section>
        <h1>Blog</h1>
        <div class="blog-list">
            for _, post := range posts {
                <article class="blog-item">
                    <h2><a href={ templ.SafeURL("/blog/" + post.Slug + ".html") }>{ post.Title }</a></h2>
                    <p class="date">{ post.Date }</p>
                    <p>{ post.Content }</p>
                </article>
            }
        </div>
    </section>
}

templ BlogPost(post data.BlogPost) {
    @Layout(post.Title, blogPostContent(post))
}

templ blogPostContent(post data.BlogPost) {
    <section>
        <h1>{ post.Title }</h1>
        <p class="date">Published: { post.Date }</p>
        <article>
            <p>{ post.Content }</p>
        </article>
        <p><a href="/blog.html">â† Back to Blog</a></p>
    </section>
}
```

### 4.5 Donation Stats Fragment (`templates/donation_stats.templ`)

```templ
package templates

import "fmt"

templ DonationStats(total float64, count int) {
    <div class="stats">
        <div class="stat">
            <strong>Total Raised:</strong>
            <span>${ fmt.Sprintf("%.2f", total) }</span>
        </div>
        <div class="stat">
            <strong>Supporters:</strong>
            <span>{ fmt.Sprintf("%d", count) }</span>
        </div>
    </div>
}
```

### 4.6 Recent Donors Fragment (`templates/donation_stats.templ` - append)

```templ
templ RecentDonors(donations []Donation) {
    if len(donations) == 0 {
        <p>No donors yet. Be the first to support our cause!</p>
    } else {
        <ul class="donor-list">
            for i := len(donations) - 1; i >= 0 && i >= len(donations)-5; i-- {
                <li>
                    <strong>{ donations[i].Name }</strong> donated <span class="amount">${ fmt.Sprintf("%.2f", donations[i].Amount) }</span>
                </li>
            }
        </ul>
    }
}
```

### 4.7 Donation Success Fragment (`templates/donation_success.templ`)

```templ
package templates

import "fmt"

templ DonationSuccess(name string, amount float64) {
    <div class="success">
        <h3>Thank you, { name }! ğŸ™</h3>
        <p>Your donation of ${ fmt.Sprintf("%.2f", amount) } is greatly appreciated.</p>
    </div>
}
```

---

## 5. Build Script (`build.go`)

This script generates static HTML at build time.

```go
package main

import (
    "context"
    "fmt"
    "os"
    "path/filepath"

    "campaign/data"
    "campaign/templates"
)

func generateStaticSite() error {
    fmt.Println("ğŸ”¨ Generating static site...")

    // Create public directory
    os.MkdirAll("public", 0755)
    os.MkdirAll("public/blog", 0755)

    // Generate home page
    if err := renderToFile("public/index.html", templates.Home()); err != nil {
        return err
    }
    fmt.Println("âœ… Generated: public/index.html")

    // Generate about page
    if err := renderToFile("public/about.html", templates.About()); err != nil {
        return err
    }
    fmt.Println("âœ… Generated: public/about.html")

    // Generate blog list
    posts := data.GetBlogPosts()
    if err := renderToFile("public/blog.html", templates.BlogList(posts)); err != nil {
        return err
    }
    fmt.Println("âœ… Generated: public/blog.html")

    // Generate individual blog posts
    for _, post := range posts {
        filename := filepath.Join("public/blog", post.Slug+".html")
        if err := renderToFile(filename, templates.BlogPost(post)); err != nil {
            return err
        }
        fmt.Printf("âœ… Generated: %s\n", filename)
    }

    // Create blank stylesheet
    if err := os.WriteFile("public/style.css", []byte("/* Your styles here */\n"), 0644); err != nil {
        return err
    }
    fmt.Println("âœ… Created: public/style.css")

    fmt.Println("âœ… Static site generation complete!")
    return nil
}

func renderToFile(filename string, component templ.Component) error {
    file, err := os.Create(filename)
    if err != nil {
        return err
    }
    defer file.Close()

    return component.Render(context.Background(), file)
}
```

---

## 6. Fiber Server (`main.go`)

```go
package main

import (
    "fmt"
    "sync"
    "time"

    "github.com/gofiber/fiber/v2"
    "campaign/templates"
)

type Donation struct {
    ID        int       `json:"id"`
    Name      string    `json:"name"`
    Email     string    `json:"email"`
    Amount    float64   `json:"amount"`
    Message   string    `json:"message,omitempty"`
    CreatedAt time.Time `json:"created_at"`
}

type AppState struct {
    donations []Donation
    nextID    int
    mu        sync.Mutex
}

var state = &AppState{
    donations: []Donation{},
    nextID:    1,
}

func main() {
    // Check for --generate flag
    if len(os.Args) > 1 && os.Args[1] == "--generate" {
        if err := generateStaticSite(); err != nil {
            fmt.Printf("Error generating static site: %v\n", err)
            os.Exit(1)
        }
        return
    }

    app := fiber.New()

    // Serve static files from public/
    app.Static("/", "./public")

    // API Routes (Dynamic)
    app.Get("/api/stats", getStats)
    app.Get("/api/recent-donors", getRecentDonors)
    app.Post("/api/donations", createDonation)

    fmt.Println("ğŸš€ Server running on http://localhost:3000")
    fmt.Println("   Static files: public/")
    fmt.Println("   API: GET /api/stats, GET /api/recent-donors, POST /api/donations")

    app.Listen(":3000")
}

// GET /api/stats - Returns live donation stats (HTML fragment for htmx)
func getStats(c *fiber.Ctx) error {
    state.mu.Lock()
    defer state.mu.Unlock()

    total := 0.0
    for _, d := range state.donations {
        total += d.Amount
    }

    c.Set("Content-Type", "text/html; charset=utf-8")
    return templates.DonationStats(total, len(state.donations)).Render(c.Context(), c.Response().BodyWriter())
}

// GET /api/recent-donors - Returns recent donor list (HTML fragment for htmx)
func getRecentDonors(c *fiber.Ctx) error {
    state.mu.Lock()
    defer state.mu.Unlock()

    c.Set("Content-Type", "text/html; charset=utf-8")
    return templates.RecentDonors(state.donations).Render(c.Context(), c.Response().BodyWriter())
}

// POST /api/donations - Create a donation
func createDonation(c *fiber.Ctx) error {
    donation := new(Donation)

    // Parse form data
    if err := c.BodyParser(donation); err != nil {
        return c.Status(400).SendString("Invalid form data")
    }

    // Validate
    if donation.Name == "" || donation.Email == "" || donation.Amount <= 0 {
        return c.Status(400).SendString("Name, email, and amount are required")
    }

    state.mu.Lock()
    donation.ID = state.nextID
    donation.CreatedAt = time.Now()
    state.nextID++
    state.donations = append(state.donations, *donation)
    state.mu.Unlock()

    // Return success message (htmx will swap into #donation-result)
    c.Set("Content-Type", "text/html; charset=utf-8")
    c.Set("HX-Trigger", "donationComplete")  // Trigger donor list refresh
    return templates.DonationSuccess(donation.Name, donation.Amount).Render(c.Context(), c.Response().BodyWriter())
}
```

---

## 7. Build Automation (`Makefile`)

```makefile
.PHONY: install generate build run clean test

install:
	go mod download
	go install github.com/a-h/templ/cmd/templ@latest

generate:
	templ generate
	go run build.go

build: generate
	go build -o campaign

run: generate
	go run main.go

dev: generate
	go run main.go

test:
	# Manual test:
	# 1. go run main.go --generate
	# 2. curl http://localhost:3000
	# 3. curl -X POST http://localhost:3000/api/donations -d "name=John&email=john@example.com&amount=50" -H "Content-Type: application/x-www-form-urlencoded"
	# 4. curl http://localhost:3000/api/stats
	# 5. curl http://localhost:3000/api/recent-donors

clean:
	rm -rf public/
	rm -f campaign
	rm -f *_templ.go

.DEFAULT_GOAL := help
help:
	@echo "Available targets:"
	@echo "  make install   - Install dependencies"
	@echo "  make generate  - Generate templ code and static HTML"
	@echo "  make build     - Build binary"
	@echo "  make run       - Run server with static generation"
	@echo "  make dev       - Alias for run"
	@echo "  make clean     - Clean build artifacts"
	@echo "  make test      - Run manual tests"
```

---

## 8. Go Module (`go.mod`)

```go
module campaign

go 1.21

require (
    github.com/gofiber/fiber/v2 v2.52.0
    github.com/a-h/templ v0.2.543
)
```

---

## 9. Quick Start Guide (for agent)

### Setup
```bash
cd campaign
make install
```

### Generate Static HTML + Templ Code
```bash
make generate
```

### Run Server
```bash
make run
```

### Visit
- Home: http://localhost:3000
- About: http://localhost:3000/about.html
- Blog: http://localhost:3000/blog.html
- Individual post: http://localhost:3000/blog/welcome.html

### Test Dynamic Features

**1. Get stats:**
```bash
curl http://localhost:3000/api/stats
```

**2. Create donation:**
```bash
curl -X POST http://localhost:3000/api/donations \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "name=Alice&email=alice@example.com&amount=100&message=Great+work!"
```

**3. Get recent donors:**
```bash
curl http://localhost:3000/api/recent-donors
```

**4. Try in browser:**
- Visit http://localhost:3000
- Watch stats load
- Fill out donation form
- See success message and donor list update

---

## 10. Architecture Summary

```
Static Pages (Pre-built)          Dynamic Features (Runtime API)
â”œâ”€â”€ index.html                    â”œâ”€â”€ GET /api/stats
â”œâ”€â”€ about.html                    â”œâ”€â”€ GET /api/recent-donors
â”œâ”€â”€ blog.html                     â””â”€â”€ POST /api/donations
â””â”€â”€ blog/*.html

Both use: Templ components (reusable, type-safe)
Frontend glue: htmx (14KB library, no framework overhead)
Backend: Go/Fiber (fast, minimal overhead)
```

---

## 11. Success Criteria (For Agent to Verify)

- [ ] `go mod download` succeeds
- [ ] `make generate` produces `public/index.html`, `public/about.html`, `public/blog.html`, `public/blog/welcome.html`
- [ ] `make run` starts server on :3000
- [ ] `curl http://localhost:3000` returns valid HTML
- [ ] `curl http://localhost:3000/api/stats` returns HTML fragment with stats
- [ ] `curl -X POST http://localhost:3000/api/donations` with form data succeeds (returns success HTML)
- [ ] `curl http://localhost:3000/api/recent-donors` shows donated amount
- [ ] Browser: stats load automatically on page load
- [ ] Browser: donation form submits without page reload
- [ ] Browser: stats and donor list update after donation without page reload

---

## 12. Key Design Decisions

| Decision | Rationale |
|----------|-----------|
| Static HTML pre-built | Fast page load, SEO-friendly, immutable content |
| Dynamic API endpoints return HTML fragments | htmx integration, no JSON parsing on frontend |
| In-memory state for PoC | Simple, no database needed for PoC |
| Templ for all HTML | Type-safe, composable, used for both SSG and runtime |
| Single `main.go` with `build.go` | Simplicity, no separate binary needed |
| Makefile for automation | Clear commands, standard Go workflow |

---

## 13. Notes for Agent

- **Do not add styling.** Blank `style.css` is intentional.
- **Generate templ code first.** Run `templ generate` before running server.
- **Test in browser, not just CLI.** Use browser DevTools to verify htmx calls.
- **Keep donations in-memory for PoC.** Database can be added later.
- **Public directory is generated.** Don't edit files in `public/` manually; regenerate with `make generate`.
- **Commits:** After scaffolding, commit the structure. After generation, add `public/` to `.gitignore`.

---

## Reference Links

- [templ docs](https://templ.guide/)
- [Fiber docs](https://docs.gofiber.io/)
- [htmx docs](https://htmx.org/docs/)
- [Go context package](https://pkg.go.dev/context)
- [Go io.Writer](https://pkg.go.dev/io#Writer)

---

**Last Updated:** 2025-11-02 18:59:49 UTC
**Ready for Scaffolding:** Yes
